<!-- 我的频道： 查看频道 创建频道 搜索频道 删除频道-->
<script>
  import PocketBase from "pocketbase";
  import { PocketBase_URL } from "../utils/api/index";
  import { push } from "svelte-spa-router";
  import Modal from "./Modal.svelte";
  import { onMount } from "svelte";
  import { currentUserEmail, currentchannelid } from "../store.js";

  const pb = new PocketBase(PocketBase_URL);
  let records = [];
  let showModal = false;
  async function checkchan() {
    try {
      const userEmail = $currentUserEmail;
      const response = await pb.collection("users_channels").getFullList({
        sort: "-created",
        filter: `useremail="${userEmail}"`,
      });
      records = response;
    } catch (error) {
      alert("fail to find");
    }
  }
  function toggleModal() {
    showModal = !showModal;
  }
  onMount(() => {
    checkchan();
  });

  function jumpnew(id) {
    currentchannelid.set(id);
    push("/chantemplate");
  }

  function JumpNewPage(address) {
    push("/" + address);
  }
</script>

<div class="left-side">
  <button class="button" on:click={toggleModal}>查看频道</button>
  <button class="button" on:click={() => JumpNewPage("createChannel")}>
    创建频道
  </button>
  <button class="button" on:click={() => JumpNewPage("searchChannel")}>
    查找频道
  </button>
  <button class="button"> 频道管理 </button>
</div>

<Modal isOpen={showModal} close={toggleModal}>
  <h2 style="color: black;">已加入的频道</h2>
  <div class="container">
    {#each records as record}
      <button class="button" on:click={() => jumpnew(record.id)}
        >#{record.channelname}</button
      >
    {/each}
  </div>
</Modal>

<style>
  .container {
    max-width: 300px;
    max-height: 200px; /* 设置列表的最大高度 */
    overflow-y: auto; /* 超出部分显示滚动条 */
    background: #f9f9f9; /* 背景色，可根据需要调整 */
    border-radius: 5px; /* 边框圆角 */
    padding: 10px; /* 内边距 */
  }
  .button {
    width: 60%;
    margin-top: 10px;
    padding: 10px;
    background-color: black;
    border-radius: 4px;
  }
  .button:hover {
    color: #ffffff;
    opacity: 1;
    background-color: #6a6d6e;
  }
  .left-side {
    width: 40%;
    height: 100vh;
    /* background-color: #f0f0f0; */
    /* 添加更多样式 */
  }
</style>
